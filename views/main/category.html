{{extend 'csi_view.html'}}

    <div id="viewbar">
        <h1 style="float:left; margin:20px; color:#FFF;">{{=category.value}}</h1>
        {{if auth.is_logged_in() and category.public:}}
            <div id="addyourself">
                <a href="{{=URL('edit', 'node', vars={'type':category.value})}}">Add your own!</a>
            </div> <!-- end addyourself -->
         {{pass}}
        <br />
    </div> <!-- end viewbar -->
<script>
{{if request.env.http_x_forwarded_for or request.env.wsgi_url_scheme in ['https', 'HTTPS']:}}
var autoload_request_url = 'https://{{=request.env.http_host}}{{=URL('main','category_ajax', args=category.value)}}';
{{else:}}
var autoload_request_url = 'http://{{=request.env.http_host}}{{=URL('main','category_ajax', args=category.value)}}';
{{pass}}
</script>
<script>
var nodes = Array();

function display_nodes(filter){
    $("#TARGET").empty()
    var i = 0;
    $.each(nodes, function(key,val){
        if( filter == null || val.name.toLowerCase().indexOf(filter.toLowerCase()) != -1 ){
        if( i < 9 ){
            var html_add = "\
                <div class='nodeBox'>\
                    <a href='{{=URL('main','node')}}/" + val.url + "'>\
                        <div class='nodePic'>\
                            <img src='" +
                                ((val.picFile==""||val.picFile==null)?"{{=URL('static', 'images', args='placeholder.png')}}":"{{=URL('default','download')}}/"+val.picFile) +
                            "' width='160px'></div>\
                        <div class='nodeName'>" + val.name + "</div>\
                    </a>\
                 </div>";
        
            $("#TARGET").append( html_add );
        }else{
            var html_add = "\
                <div class='nodeListing'>\
                    <a href='{{=URL('main','node')}}/" + val.url + "'>\
                        <div class='nodeName'>" + val.name + "</div>\
                    </a>\
                 </div>";
            $("#TARGET").append( html_add );
        }
        i++;
        }
    });
}

$(document).ready(function(){
    $.getJSON( autoload_request_url,
        function(data){
            nodes = data.rows;
            display_nodes();
        }
    );
});
</script>

<div style="text-align: center;">
<form onsubmit="return false;">
    Search: <input type="text" name="search_filter" onkeyup="display_nodes(this.value);" />
</form>
</div>
<div id="TARGET" style="clear:both;">
<img src="{{=URL('static', 'images', args='lightbox_ico_loading.gif')}}">Loading Content...
</div>
<br style="clear:both;" />
