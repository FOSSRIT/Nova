{{extend 'csi_node.html'}}

{{if can_edit(node):}}
    <div class="nodeTopLinks">
        <a href="{{=URL('edit','node', args=[node.url])}}">Edit Node</a>
        <a href="{{=URL('edit','link', args=node.url)}}"  >Link Node</a>
    </div>
{{pass}}
<br />

    <div id="nodeTitle">
        {{=node.name}}
    </div> <!-- end nodeTitle -->
    
    <div id="bigPic">
          <img src="{{=node.picURL}}"  width="300px" />
    </div> <!-- end bigPic -->
     
    <div id="sideStats">
    
    {{for x in node_attributes:}}
        
        <div class="statTitle">
            {{=x.vocab.value}}
        </div> <!-- end statTitle -->
            
        <div class="statValue">
            {{=MARKMIN(x.value)}}
        </div> <!-- end statValue -->
        
    {{pass}}
    
    </div> <!-- end sideStats -->
    
    <script type="text/javascript">
        function edit_request(url, div_loc){
 
            var div = $("#" + div_loc);

            div.load(url, function() {
                var form = $("#" + div_loc + " form");
                
                form.submit(function() {
                    var inputs = [];
                    $("#" + div_loc + " form :input").each( function() {
                        inputs.push(this.name + '=' + escape(this.value))
                    });
                  
                  $.ajax({
                      data: inputs.join('&'),
                      type: 'post',
                      url: $("#" + div_loc + " form").attr('action'),
                      success: function(r) { document.getElementById(div_loc).innerHTML=r; },
                      error: function() { alert("Failed to submit"); },
                   });
                  return false;
                });
            });
        }
    </script>
    
    <div id="descriptionBox">
    {{if can_edit(node):}}
    <a href="#" onClick='edit_request("{{=URL('edit','in_place',args=[node.url,'description'])}}","descriptionBox_cont");return false;'>EDIT</a>
    {{pass}}
    <div id="descriptionBox_cont">
    {{=MARKMIN(node.description)}} 
    </div>
    </div> <!-- end description -->
