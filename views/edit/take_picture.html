{{extend 'csi_view.html'}}

<!-- First, include the JPEGCam JavaScript Library -->
    <script type="text/javascript" src="{{=URL('static','jpegcam/webcam.js')}}"></script>
    
    <!-- Configure a few settings -->
    <script language="JavaScript">
        webcam.set_api_url( '{{=URL(args=node.url, vars={"do_upload":True})}}' );
        webcam.set_swf_url( '{{=URL('static','jpegcam/webcam.swf')}}')
        webcam.set_shutter_sound( true, '{{=URL('static','jpegcam/shutter.mp3')}}')
        webcam.set_quality( 75 ); // JPEG quality (1 - 100)
    </script>
    
    <!-- Next, write the movie to the page at 320x240 -->
    <script language="JavaScript">
        document.write( webcam.get_html(320, 240) );
    </script>
    
    <!-- Some buttons for controlling things -->
    <br/><form>
        <input type=button value="Configure..." onClick="webcam.configure()">
        &nbsp;&nbsp;
        <input type=button value="Capture" onClick="webcam.freeze()">
        &nbsp;&nbsp;
        <input type=button value="Upload" onClick="do_upload()">
        &nbsp;&nbsp;
        <input type=button value="Reset" onClick="webcam.reset()">
    </form>
    
    <script language="JavaScript">
        webcam.set_hook( 'onComplete', 'my_completion_handler' );
        
        function do_upload() {
            // upload to server
            document.getElementById('upload_results').innerHTML = '<h1>Uploading...</h1>';
            webcam.upload();
        }
        
        function my_completion_handler(msg) {
            alert(msg);
            document.getElementById('upload_results').innerHTML = msg;
        }
    </script>
        
    <div id="upload_results" style="background-color:#eee;"></div>
